> 💡 通过实现 mini webpack 来学习其原理

## 概念 📚

webpack 是一个静态模块打包工具（module bundler），它将所有的资源文件（js、css、图片等）视为模块，通过 loader 转换这些文件，通过 plugin 注入钩子，最后打包成一个或多个 bundle 文件。

主要目的是为了让浏览器能够识别和加载 js、css、图片等文件，以及解决模块之间的依赖关系。

## 工作原理

1. 读取配置文件 📃
   webpack 会根据项目中的配置文件，通常是 webpack.config.js 配置初始化所需的打包参数，包括入口文件、输出路径、加载器（loaders）和插件（plugins）等。

2. 编译
   webpack 会从入口文件开始，解析文件中的导入语句，递归地构建一个依赖关系图。在这个过程中，webpack 会根据配置文件中的 loader 对文件进行转换，以及根据插件对打包过程进行干预。

3. loader 处理
   对于每个依赖文件，Webpack 会查看是否有匹配的 loader 来处理这个文件。加载器可以将文件从不同的语言（如 TypeScript、SCSS）转换为 JavaScript，或者将图片和 CSS 转换为 JS 模块。

4. plugin 处理
   在编译过程中，Webpack 会在特定的时机广播出许多事件，插件可以监听这些事件，以执行自定义的逻辑。比如在打包结束后，Webpack 会广播出 `emit` 事件，插件可以监听这个事件，在打包结束后执行一些额外的操作。

5. 输出 📦
   经过 loader 和 plugin 的处理后，Webpack 将所有的模块打包成一个或多个 bundle（依据配置），并输出到指定的文件夹。

6. 优化
   在打包过程中，Webpack 会执行诸如代码分割、模块合并、压缩优化等操作以减小输出文件的体积和提高运行效率。

## 主要概念

入口配置
loader
plugin
输出
模式

## 实现

主要是将各个小模块转换为一个大模块，给浏览器运行。

1. 读取模块文件

- fs 读取文件

2. 根据各个文件间的关系生成依赖图

- 解决文件存在用 import 引入的问题

  - 通过正则匹配 import 语句，将文件路径转换为绝对路径

- 解析文件内容，找到 import 语句，并生成 ast 抽象语法树

- 采用 traverse 递归地解析各个依赖文件，生成对应的 code 和依赖关系

- 为什么是一个图结构？

  - 因为各个文件间可能存在循环引用的情况，所以需要一个图结构来表示各个文件间的依赖关系。

3. 递归地调用解析方法，生成对应的图结构

4. 输出到指定的文件夹

5. 实现 loader 和 plugin

loader 加载器主要是在打包过程中对文件进行转换，转换成浏览器认识的文件格式。

一个 loader 就是一个函数，接受源文件作为参数，返回转换后的文件内容。同时一个 loader 只做一件事情，满足单一原则。

注意 📢 加载 loader 的顺序以及路径处理
